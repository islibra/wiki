---
title: 锁
date: 2018-10-28 12:23:01
categories: java
tags:
---

java.util.concurrent.locks包提供的接口和类，可用来替代JDK1.5之前的synchronized和监视机制（wait(), notify(), notifyAll()）。


# synchronized典型用法

```java
private final Object LOCK = new Object();
synchronized(LOCK)
{
	//...
}
```


# Lock典型用法

```java
private static Lock lock = new ReentrantLock();

lock.lock();  //lock会阻塞该线程，直到获取到锁
try {
    //...
} catch (Exception e)
{
    //...
} finally {
    lock.unlock();
}

if(lock.tryLock())  //尝试获取锁，如果锁可用，则获取锁，并立即返回true，否则返回false。不会阻塞当前线程。
{
    try {
        //...  
    } finally {
        lock.unlock();
    }
} else {
    //...  
}
```


# 读写锁

+ 读锁允许多个reader线程同时拥有，写锁只能有一个writter线程持有。
+ 如果一个线程已持有写锁，可再持有读锁；如果已持有读锁，则必须释放读锁，才能再持有写锁。

```java
private static ReadWriteLock rwlock = new ReentrantReadWriteLock();

new Thread(){
    public void run()
    {
        try {
            rwlock.readLock().lock();
            //...
        } finally {
            rwlock.readLock().unlock();
        }
    }
}.start();

new Thread(){
    public void run()
    {
        try {
            rwlock.writeLock().lock();
            //...
        } finally {
            rwlock.writeLock().unlock();
        }
    }
}.start();
```
