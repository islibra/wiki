# 云端实验室

## 基于华为云鲲鹏弹性云服务器部署Web应用

1. IAM用户登录
1. 服务列表 - 网络 - 虚拟私有云VPC
    - 访问控制 - 安全组(同一个VPC内相互信任的云服务器, 默认组内云服务器可以相互访问, 出方向放行)
        - 创建安全组 - 入方向规则添加8080, 0.0.0.0/0

    - 创建虚拟私有云
        - 区域
        - 网段
        - 子网
            - 可用区
            - 子网网段

1. 服务列表 - 计算 - 弹性云服务器ECS
    - 购买弹性云服务器
        1. 基础配置
            - 计费模式
            - 区域
            - 可用区

            - CPU架构: x86, 鲲鹏
            - 规格
            - 镜像
            - 磁盘

        2. 网络配置
            - 网络
            - 安全组
            - 弹性公网IP
            - 线路: 全动态BGP, 静态BGP
            - 公网带宽: 按带宽计费, 按流量计费, 加入共享带宽
            - 带宽大小

        3. 高级配置
            - 登录凭证: 密码, 用户名

1. 部署
    1. 上传: `scp xxx.war root@EIP:/path/to/war`
    1. SSH: `ssh root@EIP`
    1. 下载Tomcat
    1. 拷贝war到webapps
    1. 启动Tomcat


## 基于云容器引擎部署NGINX应用

1. IAM用户登录
1. 服务列表 - 网络 - 虚拟私有云Virtual Private Cloud(VPC)
    - 创建虚拟私有云
        - 区域
        - 网段
        - 子网
            - 可用区
            - 子网网段

1. 服务列表 - 计算 - 弹性云服务器ECS
    - 密钥对
        - 创建密钥对: 自动生成密钥对

1. 服务列表 - 容器服务 - 云容器引擎Cloud Container Engine(CCE)

    > Kubernetes集群, 支持部署和运行Docker容器应用

    > 基于角色的细粒度权限控制(RBAC)

    > 虚机, 裸金属, GPU等多种异构基础设施

    > 弹性伸缩

    - 购买Kubernetes集群
        1. 服务选型
            - 计费模式
            - 区域

            - 版本: v1.13.10, v1.15.6, v1.13.7
            - 集群管理规模: 50节点
            - 高可用

            - 虚拟私有云
            - 所在子网
            - 网络模型
            - 容器网段
            - 服务网段

            - 鉴权方式
            - 认证方式

        2. 创建节点
            - 计费模式
            - 区域
            - 可用区

            - 节点类型
            - 节点规格
            - 操作系统: EulerOS 2.5, CentOS 7.6
            - 系统盘
            - 数据盘

            - 虚拟私有云
            - 所在子网
            - 弹性IP
                - 规格: 全动态BGP, 静态BGP
                - 计费模式
                - 带宽类型: 独享
                - 带宽大小

            - 登录方式
                - 密钥对

        3. 配置确认

    - 资源管理 - 集群管理
    - 工作负载 - 无状态负载Deployment
        - 创建无状态工作负载
            1. 工作负载基本信息
                - 集群名称
                - 命名空间
                - 实例数量

            2. 容器设置
                - 添加容器 - 选择镜像 - Dockerhub官方镜像 - nginx
                - 基本信息
                    - 镜像版本
                    - 容器规格
                        - CPU配额: 申请, 限制
                        - 内存配额: 申请, 限制
                        - GPU配额, GPU显卡

            3. 工作负载访问设置
                - 添加服务
                    - 访问类型

                    - 服务亲和: 集群级别, 节点级别

                    - 端口配置: TCP 容器80 访问30758

            4. 高级设置
                - 升级策略: 滚动升级, 替换升级
                - 缩容策略
                - 迁移策略

        - 外部访问地址

### FAQ

1. 华为云产品基础服务存在应用中间件, 但是没有容器化
1. 添加容器选择镜像时, 可以选择Dockerhub官方镜像, 存在redis, zookeeper, rabbitmq, 但不存在kafka
1. ServiceStage
