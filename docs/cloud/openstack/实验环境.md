# 实验环境

[DevStack](https://docs.openstack.org/devstack/latest/)

## 官方指南

1. 虚拟机镜像使用`ubuntu-18.04.2-desktop-amd64.iso`
1. 增加用户`sudo useradd -s /bin/bash -d /opt/stack -m stack`
1. 增加sudo权限`echo "stack ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/stack`
1. 切换到stack用户`sudo su - stack`
1. 下载DevStack`git clone https://git.openstack.org/openstack-dev/devstack`, `cd devstack` {>>以上已完成<<}
1. 在devstack目录下创建配置文件local.conf  
```
[[local|localrc]]
ADMIN_PASSWORD=secret
DATABASE_PASSWORD=$ADMIN_PASSWORD
RABBIT_PASSWORD=$ADMIN_PASSWORD
SERVICE_PASSWORD=$ADMIN_PASSWORD
```

    !!! tip
        示例文件路径`/opt/stack/devstack/samples/local.conf`

1. 安装`./stack.sh`


## 部署拓扑

1. 控制节点：管理OpenStack，服务包含keystone, glance, horizon和部分nova, neutron，支撑服务MySQL, RabbitMQ, NTP。
1. 网络节点：neutron，提供虚拟机网络，DHCP，路由，NAT。
1. 存储节点：cinder, swift
1. 计算节点：运行Hypervisor(KVM), neutron agent。

!!! note
    - 四类节点可分别部署在若干台物理服务器上。
    - All-in-One: 四类节点部署在一个物理或虚拟服务器上。

### controller: 控制 网络 块存储 计算

- 2U
- 8G
- 100G(VDI, Dynamically allocated)
- eth0: 管理网络`192.168.104.0/24`，internet, Bridged Adapter
- eth1: 租户网络，控制节点和计算节点互通，Internal Network
- eth2: 外网，Host-only Adapter
- 安装光盘：ubuntu-16.04.1-server-amd64.iso
- 开机安装操作系统，安装组件：`OpenSSH server`, `Virtual Machine host`
- 开启wifi，VM获取IP后，在终端ssh登录，sudo到root，设置root密码，配置`/etc/ssh/sshd_config`，修改`PermitRootLogin`为`yes`，重启ssh服务：`systemctl restart sshd.service`，使用root登录。
- 配置IP，`/etc/network/interfaces`，`reboot`重启操作系统，使用固定IP登录。
    - eth0: DHCP修改为固定IP。
    - eth1: 启用
    - eth2: 启用
- 修改apt源：`/etc/apt/sources.list`，`apt-get update`

!!! info
    - ubuntu默认不允许root登录，因此需创建普通用户。
    - 安装过程中关闭wifi。

### compute: 计算

- 4U
- 8G
- 100G
- eth0: Bridged Adapter
- eth1: Internal Network


## 网络规划

- Management + API Network: OpenStack内部各服务之间通信。
- VM(Tenant) Network: 租户创建的VM使用的网络。
- External Network: neutron通过L3服务让VM租户内部私有网络能够访问到外网。


!!! quote "已读"
    [搭建 OpenStack 实验环境 - 每天5分钟玩转 OpenStack（16）](https://mp.weixin.qq.com/s?__biz=MzIwMTM5MjUwMg==&mid=2653587901&idx=1&sn=21a38340604708a11f1d203b5500ccfb&chksm=8d3081a4ba4708b292d285cddf18455870a28a2a7585b73d21507529e71fcc8c683a8c0169c2&scene=21#wechat_redirect)
