# 网络虚拟化

## Linux bridge

相当于二层交换机。  
为了让VM可以访问网络，为VM1分配虚拟网卡vnet0（host中的TAP设备）通过Bridge br0与host的eth0相连。

!!! tip
    virbr0是KVM默认创建的bridge。使用dnsmasq提供DHCP服务，在HOST中查看进程：`ps -ef | grep dnsmasq`

### 配置

在HOST上配置文件路径：`/etc/network/interfaces`，增加br0，并将dhcp配置到br0上。增加`bridge_ports eth0`，将eth0挂到br0上。  
在HOST上查看bridge配置：`brctl show`  
使用virt-manager将VM1的网卡配置为br0。

!!! example "KVM命令行"
    - 查看虚拟机列表：`virsh list --all`  
    - 启动虚拟机：`virsh start VM1`
    - 查看VM接口列表：`virsh domiflist VM1`

## VLAN

LAN: 使用Hub或Switch连接，同一个广播域。

VLAN: Switch将端口划分出多个LAN。

!!! tip
    不同VLAN在三层网络可以互通。

交换机的端口有两种配置模式：Access和Trunk。

- Access口：端口属于VLAN，VLAN ID 1~4096。直接与计算机网卡相连，流入该口的数据包都被打上VLAN的标签。
- Trunk口：允许多个VLAN数据通过，通过时不更换VLAN标签。

### 网卡

- 物理网卡eth0: 服务器上实际的网络接口设备eth0, eth1...
- 子网卡eth0:1: 依赖于物理网卡，可以与物理网卡同时存在并使用不同的IP地址，使用自己的网络接口配置文件。{>>与物理网卡同时启用<<}
- ==虚拟VLAN== 网卡eth0.1: 
